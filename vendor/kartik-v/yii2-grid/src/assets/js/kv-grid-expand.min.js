/*!
 * @package   yii2-grid
 * @author    Kartik Visweswaran <kartikv2@gmail.com>
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2020
 * @version   3.3.5
 *
 * jQuery methods library for yii2-grid expand row column
 * 
 * Author: Kartik Visweswaran
 * Copyright: 2014 - 2020, Kartik Visweswaran, Krajee.com
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
var kvExpandRow;!function(e){"use strict";kvExpandRow=function(n,t){var a=".kvExpandRowColumn",l="kvRowNum_"+t,o=n.gridId,i=n.hiddenFromExport,d=n.detailUrl,r=n.onDetailLoaded,s=n.expandIcon,c=n.collapseIcon,v=n.expandTitle,p=n.collapseTitle,f=n.expandAllTitle,u=n.collapseAllTitle,h=n.expandOneOnly,x=n.enableRowClick,g=n.rowClickExcludedTags,k=n.enableCache,w=n.extraData,$=n.msgDetailLoading,m=i?n.rowCssClass+" skip-export":n.rowCssClass,C=n.animationDuration,y=e("#"+o),A="."+t,I=y.find(".kv-expand-header-cell.kv-batch-toggle"+A),b=I.find(".kv-expand-header-icon"),R=void 0===n.collapseAll?!1:n.collapseAll,T=void 0===n.expandAll?!1:n.expandAll,E=y.find("td.kv-expand-icon-cell"+A+" .kv-expand-row:not(.kv-state-disabled)"),K=E.length,N="kv-expand-detail-loading",D=function(){var n=y.find("td.kv-expand-icon-cell"+A+":first"),t=n&&n.length?n.closest("tr"):"",a=0;return t&&t.length?(t.find("> td").each(function(){"none"!==e(this).css("display")&&a++}),a):0},j=D(),L=function(e){return e.hasClass("kv-state-collapsed")&&!e.hasClass("kv-state-disabled")},O=function(e){return e.hasClass("kv-state-expanded")&&!e.hasClass("kv-state-disabled")},P=function(e,n){e.length&&e.removeClass(n).addClass(n)},S=function(e){e.removeClass("kv-state-collapsed").addClass("kv-state-expanded")},U=function(e){e.removeClass("kv-state-expanded").addClass("kv-state-collapsed")},F=function(e){P(e,N)},Q=function(e){if(e.length){var n=isNaN(C)?1e3:C+200;setTimeout(function(){e.removeClass(N)},n)}},_=function(){var e=y.data(l);return e=e?parseInt(e):0,isNaN(e)?0:e},q=function(e){y.data(l,e)},z=function(){var e=_();y.data(l,e+1)},B=function(e,n,t,l){var o=l?n:n.split(" ").join(a+" ")+a;e.length&&e.off(o).on(o,t)},G=function(e){var n=this;n.$element=e,n.init()};return G.prototype={constructor:G,init:function(){var e,n=this;n.$row=n.$element.closest("tr"),n.$icon=n.$element.find(">.kv-expand-icon"),n.$detail=n.$element.find(".kv-expanded-row"+A+":first"),n.$cell=n.$icon.closest(".kv-expand-icon-cell"),n.$container=n.$cell.find(".kv-expand-detail:first"),n.vKey=n.$detail.data("key"),n.vInd=n.$detail.data("index"),0===n.$detail.length&&(n.vKey=n.$row.data("key"),e=n.$row.next('tr.kv-expand-detail-row[data-key="'+n.vKey+'"]'),n.$detail=e.find(".kv-expanded-row"))},run:function(){var n=this,t=n.$row,a=n.$cell,l=n.$icon;if(L(l)||O(l)){if(T)return O(l)&&n.load(function(){n.expand(!0),z(),_()>=K&&(Q(I),b.focus())}),void(_()>=K&&(Q(I),b.focus()));if(R)return L(l)&&(n.collapse(),z(),_()>=K&&(Q(I),b.focus())),void(_()>=K&&(Q(I),b.focus()));L(l)&&(d?n.load(function(){n.expand(!1)}):n.expand(!1)),B(a,"click",function(e){n.toggle(),e.stopPropagation()}),B(t,"click",function(t){var a=t.target,l=e(a).length&&e(a).hasClass("kv-disable-click")||-1!==e.inArray(a.nodeName,g);x&&!l&&n.toggle()})}},load:function(n){var t=this,a=t.$cell,l=t.$detail,o=t.vKey,i=t.vInd,s=e.extend({expandRowKey:o,expandRowInd:i},w),c=k?0===l.html().length:!0;return d.length>0&&c?void e.ajax({type:"POST",data:s,url:d,beforeSend:function(){F(a),y.trigger("kvexprow:beforeLoad",[i,o,w]),l.html($)},success:function(e){l.html(e),Q(a),"function"==typeof r&&r(),n(),y.trigger("kvexprow:loaded",[i,o,w])},error:function(){l.html('<div class="alert alert-danger">Error fetching data. Please try again later.</div>'),y.trigger("kvexprow:error",[i,o,w]),Q(a)}}):(Q(a),void("function"==typeof n&&n()))},expand:function(n){var t=this,a=t.$row,l=t.$icon,o=t.$cell,i=t.$detail,r=t.vKey,s=t.vInd,v=d.length>0;if(!L(l)){v||F(o),y.find('tr[data-index="'+s+'"]').remove(),i.hide(),a.after(i);var f='<tr class="kv-expand-detail-row '+m+'" data-key="'+r+'" data-index="'+s+'">';i.wrap('<td colspan="'+j+'">').parent().wrap(f),l.html(c),o.attr("title",p),n?i.slideDown(C,function(){U(l),i.show()}):(i.show(),U(l));var u=a.prevAll(),h=a.index()+1;u.push(a),e.each(u,function(n,t){var a=e(t).find("td[rowspan]");e.each(a,function(n,a){var l=parseInt(e(a).attr("rowspan"));e(t).index()+l>h&&e(a).attr("rowspan",l+1)})}),v||Q(o)}},collapse:function(n){var t=this,a=t.$row,l=t.$icon,o=t.$cell,i=t.$detail,d=t.$container;O(l)||(n||F(o),d.html(""),l.html(s),o.attr("title",v),i.slideUp(C,function(){i.unwrap().unwrap(),i.appendTo(d),S(l);var n=a.prevAll();n.push(a);var t=a.index()+1;e.each(n,function(n,a){var l=e(a).find("td[rowspan]");e.each(l,function(n,l){var o=parseInt(e(l).attr("rowspan"));e(a).index()+o>t&&e(l).attr("rowspan",o-1)})})}),n||Q(o))},toggle:function(){var n,t=this,a=t.$icon,l=t.$cell,o=!1,i=t.vKey,d=t.vInd;if(!l.hasClass(N))return O(a)?(n=h&&!R,n&&(E.each(function(){var n=new G(e(this));n.collapse(!0)}),o=!0),t.load(function(){t.expand(!0)}),void(n&&!o||(y.trigger("kvexprow:toggle",[d,i,w,!0]),a.focus()))):void(L(a)&&(t.collapse(),y.trigger("kvexprow:toggle",[d,i,w,!1]),a.focus()))}},E.each(function(){}),y.data(l)||q(0),0===w.length&&(w={}),0===E.length?void P(I,"kv-state-disabled"):(E.each(function(){var n=e(this),t=new G(n),a=n.find(">.kv-expand-icon");L(a)&&(t.collapse(!1),t.expand(!1)),t.run()}),void(I.length&&B(I,"click",function(){if(!I.hasClass(N)&&0!==E.length){var a=O(b),l=L(b),o=e.extend(!0,{},n,{expandAll:l,collapseAll:a});F(I),l?(q(E.find(".kv-state-collapsed").length),S(b),b.html(c),I.attr("title",u),y.trigger("kvexprow:toggleAll",[w,!1])):a&&(q(E.find(".kv-state-expanded").length),U(b),b.html(s),I.attr("title",f),y.trigger("kvexprow:toggleAll",[w,!0])),kvExpandRow(o,t)}})))}}(window.jQuery);